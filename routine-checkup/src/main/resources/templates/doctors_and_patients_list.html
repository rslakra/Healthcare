<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Routine Checkup</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script src="js/app.js"></script>
</head>
<body>
    <div th:replace="~{fragments/navigation :: nav}"></div>
    
    <div class="container fade-in">
        <div class="page-header">
            <h1>Welcome back, <span th:text="${doc_and_pat.getUser().getFirstName()} + ' ' + ${doc_and_pat.getUser().getLastName()}"></span>! üëã</h1>
            <p>Manage your health records and appointments</p>
        </div>

        <!-- Profile Section -->
        <div class="profile-section">
            <div>
                <img th:if="${doc_and_pat.userPicUrl} != null"
                     th:attr="src=${doc_and_pat.userPicUrl}" 
                     class="profile-picture"
                     alt="Profile Picture">
                <div th:unless="${doc_and_pat.userPicUrl} != null" 
                     class="profile-picture" 
                     style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                    [[${doc_and_pat.getUser().getFirstName().substring(0,1)}]]
                </div>
            </div>
            <div style="flex: 1;">
                <h2>Profile Picture</h2>
                <form th:action="@{/user_pic}" method="POST" th:object="${change_pic_dto}" class="d-flex gap-2" style="align-items: flex-end;">
                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="pic_url">Update Profile Picture URL</label>
                        <input id="pic_url" type="url" th:field="*{url}" placeholder="https://example.com/image.jpg">
                    </div>
                    <button type="submit" class="btn btn-secondary">Update</button>
                </form>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 th:text="${doc_and_pat.getPatients().size()}">0</h3>
                <p>Active Patients</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));">
                <h3 th:text="${doc_and_pat.getDoctors().size()}">0</h3>
                <p>Doctors</p>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="card">
            <div class="card-header">
                <h2>Quick Actions</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <a th:href="@{/monthly_report}" class="btn btn-outline">üìä Report Management</a>
                <a th:href="@{/doctors}" class="btn btn-outline">üîç Search Doctors</a>
                <button onclick="updUser()" class="btn btn-outline">üë§ Update Profile</button>
            </div>
        </div>

        <!-- Services Section -->
        <div class="card">
            <div class="card-header">
                <h2>Book a Service</h2>
            </div>
            <form th:action="@{/services}" method="get">
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="act_type" value="on_house" id="on_house_r" required>
                        <span><strong>üè† Home Visit</strong> - Call a doctor at home</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="act_type" value="online" id="online_r" required>
                        <span><strong>üíª Online Consultation</strong> - Virtual appointment</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Continue to Services</button>
            </form>
        </div>

        <!-- Patients Section -->
        <div class="card">
            <div class="card-header">
                <h2>Your Patients</h2>
            </div>
            <div class="table-container">
                <table id="patient_table">
                    <thead>
                        <tr>
                            <th>Disease</th>
                            <th>Doctor</th>
                            <th>Onset Date</th>
                            <th>Recovery Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="pat : ${doc_and_pat.getPatients()}">
                            <td th:text="${pat.getDisease()}" th:attr="id='pat_dis' + ${pat.getId()}"></td>
                            <td th:text="${pat.getDoctor().getLastName()}" 
                                th:attr="id='pat_doc' + ${pat.getId()}, doc_id=${pat.getDoctor().getId()}"></td>
                            <td th:text="${pat.getDiseaseOnsetTime()}" th:attr="id='pat_ons' + ${pat.getId()}"></td>
                            <td th:text="${pat.getEndTimeOfIllness() ?: 'Ongoing'}" th:attr="id='pat_end' + ${pat.getId()}"></td>
                            <td>
                                <span th:if="${pat.getEndTimeOfIllness() == null}" 
                                      style="color: var(--warning-color); font-weight: 600;">Active</span>
                                <span th:unless="${pat.getEndTimeOfIllness() == null}" 
                                      style="color: var(--success-color); font-weight: 600;">Recovered</span>
                            </td>
                            <td>
                                <button th:attr="id='pat' + ${pat.getId()}"
                                        onclick="updPatient(this.getAttribute('id'))"
                                        class="btn btn-sm btn-outline">Update</button>
                            </td>
                        </tr>
                        <tr th:if="${doc_and_pat.getPatients().isEmpty()}">
                            <td colspan="6" style="text-align: center; color: var(--text-light); padding: 2rem;">
                                No patients records found. Add a patient to get started.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Doctors Section -->
        <div class="card">
            <div class="card-header">
                <h2>Your Doctors</h2>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Specialty</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="doc : ${doc_and_pat.getDoctors()}">
                            <td th:text="${doc.getSpeciality()}"></td>
                            <td>
                                <button th:attr="id='doc' + ${doc.getId()}"
                                        onclick="updDoctor(this.getAttribute('id'))"
                                        class="btn btn-sm btn-outline">Update</button>
                            </td>
                        </tr>
                        <tr th:if="${doc_and_pat.getDoctors().isEmpty()}">
                            <td colspan="2" style="text-align: center; color: var(--text-light); padding: 2rem;">
                                No doctors assigned yet.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
