<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments :: head('Activities - HealthSuite')}"></head>
<body>
    <div th:replace="~{fragments :: navbar}"></div>
    <div th:replace="~{fragments :: sidebar('exercises')}"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-card">
            <div class="page-header">
                <h1>üìä Activities <span class="item-count" th:text="'(' + ${exercises != null ? exercises.size() : 0} + ')'">(0)</span></h1>
                <a th:href="@{/add-exercise}" class="btn-submit btn-add">‚ûï Add Exercise</a>
            </div>
            
            <div th:if="${exercises == null || exercises.isEmpty()}" style="padding: 40px; text-align: center; color: #666;">
                <p style="font-size: 18px; margin-bottom: 20px;">No exercises recorded yet.</p>
                <a th:href="@{/add-exercise}" class="btn-submit btn-add">Add Your First Exercise</a>
            </div>
            
            <div th:if="${exercises != null && !exercises.isEmpty()}">
                <table class="table table-striped table-bordered" style="width: 100%; margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Activity</th>
                            <th>Minutes</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="exercise : ${exercises}">
                            <td th:text="${#temporals.format(exercise.exerciseDate, 'yyyy-MM-dd')}">Date</td>
                            <td th:text="${exercise.activity}">Activity</td>
                            <td th:text="${exercise.minutes}">Minutes</td>
                            <td th:text="${exercise.description != null ? exercise.description : '-'}">Description</td>
                            <td>
                                <a th:href="@{/exercises/{id}/edit(id=${exercise.id})}" 
                                   class="btn-submit" 
                                   style="padding: 6px 12px; font-size: 14px; text-decoration: none; display: inline-block;">‚úèÔ∏è Edit</a>
                                <form th:action="@{/exercises/{id}/delete(id=${exercise.id})}" 
                                      method="post" 
                                      style="display: inline-block; margin-left: 5px;"
                                      onsubmit="return confirm('Are you sure you want to delete this exercise?');">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button type="submit" class="btn-cancel" style="padding: 6px 12px; font-size: 14px; cursor: pointer;">üóëÔ∏è Delete</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background-color: #e8f4f8; border-radius: 8px;">
                    <strong>Total Minutes:</strong> <span id="totalMinutes">0</span>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments :: scripts}"></div>
    <script type="text/javascript">
        // Calculate total minutes - ensure jQuery is loaded
        if (typeof jQuery !== 'undefined') {
            jQuery(document).ready(function($) {
                // Calculate total minutes
                var totalMinutes = 0;
                $('table tbody tr').each(function() {
                    var minutesText = $(this).find('td').eq(2).text().trim();
                    var minutes = parseInt(minutesText) || 0;
                    totalMinutes += minutes;
                });
                $('#totalMinutes').text(totalMinutes);
            });
        }
    </script>
</body>
</html>

