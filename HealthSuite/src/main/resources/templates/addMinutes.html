<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments :: head('Log Minutes - HealthSuite')}"></head>
<body>
    <div th:replace="~{fragments :: navbar}"></div>
    <div th:replace="~{fragments :: sidebar('add-minutes')}"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-card">
            <h1>⏱️ Log Minutes</h1>
            <p>Record your exercise minutes and activity.</p>
            
            <div style="margin-bottom: 20px;">
                <a class="btn" th:href="@{/add-minutes(language='en')}">English</a>
                <a class="btn" th:href="@{/add-minutes(language='es')}">Spanish</a>
            </div>
            
            <form th:action="@{/add-minutes}" th:object="${exercise}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                
                <div th:if="${#fields.hasErrors('*')}" class="errorblock" style="padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; margin-bottom: 20px;">
                    <ul style="margin: 0; padding-left: 20px;">
                        <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="minutes">
                        <span th:text="#{minutes.text}">Enter Minutes:</span> *
                    </label>
                    <input type="number" id="minutes" th:field="*{minutes}" 
                           min="1"
                           th:class="${#fields.hasErrors('minutes')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('minutes')}" class="error" th:errors="*{minutes}"></span>
                </div>

                <div class="form-group">
                    <label for="activity">
                        <span th:text="#{minutes.activity}">Activity:</span> *
                    </label>
                    <select id="activities" th:field="*{activity}" 
                            th:class="${#fields.hasErrors('activity')} ? 'error' : ''" required>
                        <option value="">--Please select one--</option>
                    </select>
                    <span th:if="${#fields.hasErrors('activity')}" class="error" th:errors="*{activity}"></span>
                </div>

                <button type="submit" class="btn-submit" th:text="#{minutes.button.enter}">Enter</button>
                <a th:href="@{/}" class="btn-cancel" style="margin-left: 10px;">Cancel</a>
            </form>

            <div th:if="${goal != null}" style="margin-top: 20px; padding: 15px; background-color: #e8f4f8; border-radius: 8px;">
                <strong><span th:text="#{minutes.goal}">Goal:</span></strong>
                <span th:text="${goal.minutes}"></span> minutes
            </div>
        </div>
    </div>

    <div th:replace="~{fragments :: scripts}"></div>
    <script type="text/javascript">
        // Load activities from API
        if (typeof jQuery !== 'undefined') {
            jQuery(document).ready(function($) {
                $.ajax({
                    url: /*[[@{/activities.json}]]*/ '/activities.json',
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        var html = '<option value="">--Please select one--</option>';
                        if (data && data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                html += '<option value="' + data[i].desc + '">'
                                    + data[i].desc
                                    + '</option>';
                            }
                        }
                        $('#activities').html(html);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error loading activities: ', status, error);
                        $('#activities').html('<option value="">Error loading activities</option>');
                    }
                });
            });
        }
    </script>
</body>
</html>

