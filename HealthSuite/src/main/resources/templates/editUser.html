<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments :: head('Edit User - HealthSuite')}"></head>
<body>
    <div th:replace="~{fragments :: navbar}"></div>
    <div th:replace="~{fragments :: sidebar('add-users')}"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-card">
            <h1 th:text="${user.id != null ? 'âœï¸ Edit User' : 'ðŸ‘¤ Add User'}">Edit User</h1>
            <p th:text="${user.id != null ? 'Update user information.' : 'Add a new user to HealthSuite.'}">Edit user</p>
            
            <!-- Form for new users -->
            <form th:if="${user.id == null}" th:action="@{/users}" th:object="${user}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" th:field="*{id}"/>
                
                <div th:if="${error != null}" class="errorblock" style="padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; margin-bottom: 20px;">
                    <span th:text="${error}"></span>
                </div>
                
                <div th:if="${#fields.hasErrors('*')}" class="errorblock" style="padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; margin-bottom: 20px;">
                    <ul style="margin: 0; padding-left: 20px;">
                        <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="username">Username: *</label>
                    <input type="text" id="username" th:field="*{username}" 
                           th:class="${#fields.hasErrors('username')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('username')}" class="error" th:errors="*{username}"></span>
                </div>

                <div class="form-group">
                    <label for="email">Email: *</label>
                    <input type="email" id="email" th:field="*{email}" 
                           th:class="${#fields.hasErrors('email')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('email')}" class="error" th:errors="*{email}"></span>
                </div>

                <div class="form-group">
                    <label for="firstName">First Name:</label>
                    <input type="text" id="firstName" th:field="*{firstName}" 
                           th:class="${#fields.hasErrors('firstName')} ? 'error' : ''"/>
                    <span th:if="${#fields.hasErrors('firstName')}" class="error" th:errors="*{firstName}"></span>
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name:</label>
                    <input type="text" id="lastName" th:field="*{lastName}" 
                           th:class="${#fields.hasErrors('lastName')} ? 'error' : ''"/>
                    <span th:if="${#fields.hasErrors('lastName')}" class="error" th:errors="*{lastName}"></span>
                </div>

                <div class="form-group">
                    <label for="password">Password: *</label>
                    <input type="password" id="password" th:field="*{password}" 
                           th:class="${#fields.hasErrors('password')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('password')}" class="error" th:errors="*{password}"></span>
                </div>

                <button type="submit" class="btn-submit">Add User</button>
                <a th:href="@{/users}" class="btn-cancel" style="margin-left: 10px;">Cancel</a>
            </form>
            
            <!-- Form for editing existing users -->
            <form th:if="${user.id != null}" th:action="@{/users/{id}(id=${user.id})}" th:object="${user}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" th:field="*{id}"/>
                
                <div th:if="${error != null}" class="errorblock" style="padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; margin-bottom: 20px;">
                    <span th:text="${error}"></span>
                </div>
                
                <div th:if="${#fields.hasErrors('*')}" class="errorblock" style="padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; margin-bottom: 20px;">
                    <ul style="margin: 0; padding-left: 20px;">
                        <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="username-edit">Username: *</label>
                    <input type="text" id="username-edit" th:field="*{username}" 
                           th:readonly="true"
                           th:class="${#fields.hasErrors('username')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('username')}" class="error" th:errors="*{username}"></span>
                    <small style="display: block; color: #666; margin-top: 5px;">Username cannot be changed</small>
                </div>

                <div class="form-group">
                    <label for="email-edit">Email: *</label>
                    <input type="email" id="email-edit" th:field="*{email}" 
                           th:class="${#fields.hasErrors('email')} ? 'error' : ''" required/>
                    <span th:if="${#fields.hasErrors('email')}" class="error" th:errors="*{email}"></span>
                </div>

                <div class="form-group">
                    <label for="firstName-edit">First Name:</label>
                    <input type="text" id="firstName-edit" th:field="*{firstName}" 
                           th:class="${#fields.hasErrors('firstName')} ? 'error' : ''"/>
                    <span th:if="${#fields.hasErrors('firstName')}" class="error" th:errors="*{firstName}"></span>
                </div>

                <div class="form-group">
                    <label for="lastName-edit">Last Name:</label>
                    <input type="text" id="lastName-edit" th:field="*{lastName}" 
                           th:class="${#fields.hasErrors('lastName')} ? 'error' : ''"/>
                    <span th:if="${#fields.hasErrors('lastName')}" class="error" th:errors="*{lastName}"></span>
                </div>

                <div class="form-group">
                    <label for="enabled-edit">Status:</label>
                    <select id="enabled-edit" th:field="*{enabled}">
                        <option th:value="true">Active</option>
                        <option th:value="false">Inactive</option>
                    </select>
                </div>

                <button type="submit" class="btn-submit">Update User</button>
                <a th:href="@{/users}" class="btn-cancel" style="margin-left: 10px;">Cancel</a>
            </form>
        </div>
    </div>

    <div th:replace="~{fragments :: scripts}"></div>
</body>
</html>
